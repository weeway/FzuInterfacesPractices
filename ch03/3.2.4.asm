;8253产生1ms延迟，16次产生梯形波，最高-2.5V
DATA SEGMENT
DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE,DS:DATA

START:
	MOV  AX,DATA
	MOV  DS,AX
	MOV  AL,0H

	CALL INIT_8253

DRAW_ASCEND-LINE:		;画上升的腰
	MOV  DX,280H
	OUT  DX,AL
	CALL DELAY_1ms
	CMP  AL,80H
	JZ   DRAW_HORIZONT_LINE

	ADD  AL,08H
	JMP  DRAW_ASCEND_LINE

DRAW_HORIZON_LINE:
	MOV  CX,10H
AGAIN:
	OUT  DX,AL
	CALL DELAY_1ms
	LOOP AGAIN
DRAW_DESCNED_LINE:
	SUB  AL,08H
	MOV  DX,280H
	OUT  DX,AL
	CALL DELAY_1ms
	CMP  AL,00H
	JZ   DRAW_ASCEND_LINE
	JMP  DRAW_DESCNED_LINE
	MOV  AH,4CH
	INT  21H

;1ms 方波
INIT_8253 PROC
    PUSH DX
    PUSH AX

    MOV DX,CLT1
    MOV AL,00110111B 
    OUT DX,AL

    MOV DX,T0
    MOV AL,00H
    OUT DX,AL

    MOV AL,20H
    OUT DX,AL

    
    MOV DX,CLT1
    MOV AL,01110111B 
    OUT DX,AL

    MOV DX,T1
    MOV AL,00H
    OUT DX,AL

    MOV AL,10H
    OUT DX,AL

    POP AX
    POP DX

    RET
INIT_8253 ENDP

DELAY_1ms PROC
    PUSH DX
    PUSH AX

;检测负脉冲
LOOP_CHECK:      
    MOV  DX,PC
    IN   AL,DX
    TEST AL,80H
    JNZ  LOOP_CHECK

;等待负脉冲消耗完
LOOP_C:       
    MOV  DX,PC
    IN   AL,DX
    TEST AL,80H
    JNZ  LOOP_C

    POP  AX
    POP  DX
    RET
DELAY_1ms ENDP

CODE  ENDS
END  START